{% extends 'base.html' %}
{% load static %}
{% block title %}Ù¾Ù†Ù„ Ù…Ø´Ø§ÙˆØ±{% endblock %}

{% block content %}
<div class="counselor-dashboard">

  <!-- ðŸ§­ Ù‡Ø¯Ø± -->
  <div class="counselor-header">
    <h1>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ø´Ø§ÙˆØ±</h1>
    <p>Ù„ÛŒØ³Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ø´Ø¯Ù‡</p>
  </div>

  <!-- ðŸ“‹ Ù„ÛŒØ³Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²Ø§Ù† -->
  <div class="requests-list">
    {% for student in mess %}
    <div class="request-card">
      <div class="request-header">
        <div class="student-info">
          <h3>{{ student.first_name }} {{ student.last_name }}</h3>
          <span class="student-grade">
            Ú©Ù„Ø§Ø³: {{ student.class_name.grade }} {{ student.class_name.name }}
          </span>
        </div>
        <div class="request-meta">
          <span class="request-date">Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³: {{ student.phone }}</span>
        </div>
      </div>

      <div class="request-details">
        <div class="detail-item">
          <label>ØªÙˆØ¶ÛŒØ­Ø§Øª:</label>
          <p class="description">{{ student.description|default:"â€”" }}</p>
        </div>
      </div>

      <div class="request-actions">
        <hr>
      </div>
    </div>
    {% empty %}
    <div class="no-requests">
      <p>Ù‡ÛŒÚ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.</p>
    </div>
    {% endfor %}
  </div>
</div>

<!-- ðŸªŸ Ù…ÙˆØ¯Ø§Ù„ Ø¬Ø²Ø¦ÛŒØ§Øª -->
<div id="detailsModal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>Ø¬Ø²Ø¦ÛŒØ§Øª Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ²</h3>
      <span class="close" onclick="closeModal()">&times;</span>
    </div>
    <div class="modal-body" id="modalContent">
      <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ù…ÙˆØ¯Ø§Ù„ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ø¯Ø§ÛŒÙ†Ø§Ù…ÛŒÚ© Ù¾Ø± Ù…ÛŒâ€ŒØ´ÙˆØ¯ -->
    </div>
  </div>
</div>

<script>
function viewDetails(studentId) {
  fetch(`/students/${studentId}/details/`)
    .then(response => response.text())
    .then(html => {
      document.getElementById('modalContent').innerHTML = html;
      document.getElementById('detailsModal').style.display = 'block';
    });
}

function deleteStudent(studentId) {
  if (confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¯Ø§Ù†Ø´â€ŒØ¢Ù…ÙˆØ² Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) {
    fetch(`/students/${studentId}/delete/`, {
      method: 'DELETE',
      headers: { 'X-CSRFToken': '{{ csrf_token }}' }
    }).then(response => {
      if (response.ok) {
        location.reload();
      }
    });
  }
}

function closeModal() {
  document.getElementById('detailsModal').style.display = 'none';
}
</script>
{% endblock %}
